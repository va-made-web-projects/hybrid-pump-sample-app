"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1727],{8938:(g,A,c)=>{function r(f){return function E(f){return new DataView(Uint8Array.from(f).buffer)}(f.trim().split(" ").filter(o=>""!==o).map(o=>parseInt(o,16)))}function d(f){return function l(f){return Array.from(new Uint8Array(f.buffer,f.byteOffset,f.byteLength))}(f).map(b=>{let o=b.toString(16);return 1==o.length&&(o="0"+o),o}).join(" ")}function v(f){if("string"==typeof f)return f;if("number"==typeof f)return function u(f){return`0000${f.toString(16).padStart(4,"0")}-0000-1000-8000-00805f9b34fb`}(f);throw new Error("Invalid UUID")}function _(f){const b={};if(f)return f.forEach((o,t)=>{b[t.toString()]=o}),b}c.d(A,{AG:()=>v,BR:()=>r,Li:()=>_,pX:()=>d})},3643:(g,A,c)=>{c.d(A,{Fk:()=>b});var n=c(467),D=c(5083),u=c(8938);const r=(0,D.F3)("BluetoothLe",{web:()=>c.e(1545).then(c.bind(c,1545)).then(o=>new o.BluetoothLeWeb)});function v(o){return o?(()=>{let o=Promise.resolve();return t=>new Promise((e,i)=>{o=o.then(()=>t()).then(e).catch(i)})})():t=>t()}function _(o){if("string"!=typeof o)throw new Error(`Invalid UUID type ${typeof o}. Expected string.`);if(!((o=o.toLowerCase()).search(/^[0-9a-f]{8}\b-[0-9a-f]{4}\b-[0-9a-f]{4}\b-[0-9a-f]{4}\b-[0-9a-f]{12}$/)>=0))throw new Error(`Invalid UUID format ${o}. Expected 128 bit string (e.g. "0000180d-0000-1000-8000-00805f9b34fb").`);return o}const b=new class f{constructor(){this.scanListener=null,this.eventListeners=new Map,this.queue=v(!0)}enableQueue(){this.queue=v(!0)}disableQueue(){this.queue=v(!1)}initialize(t){var e=this;return(0,n.A)(function*(){yield e.queue((0,n.A)(function*(){yield r.initialize(t)}))})()}isEnabled(){var t=this;return(0,n.A)(function*(){return yield t.queue((0,n.A)(function*(){return(yield r.isEnabled()).value}))})()}requestEnable(){var t=this;return(0,n.A)(function*(){yield t.queue((0,n.A)(function*(){yield r.requestEnable()}))})()}enable(){var t=this;return(0,n.A)(function*(){yield t.queue((0,n.A)(function*(){yield r.enable()}))})()}disable(){var t=this;return(0,n.A)(function*(){yield t.queue((0,n.A)(function*(){yield r.disable()}))})()}startEnabledNotifications(t){var e=this;return(0,n.A)(function*(){yield e.queue((0,n.A)(function*(){var i;const s="onEnabledChanged";yield null===(i=e.eventListeners.get(s))||void 0===i?void 0:i.remove();const a=yield r.addListener(s,h=>{t(h.value)});e.eventListeners.set(s,a),yield r.startEnabledNotifications()}))})()}stopEnabledNotifications(){var t=this;return(0,n.A)(function*(){yield t.queue((0,n.A)(function*(){var e;const i="onEnabledChanged";yield null===(e=t.eventListeners.get(i))||void 0===e?void 0:e.remove(),t.eventListeners.delete(i),yield r.stopEnabledNotifications()}))})()}isLocationEnabled(){var t=this;return(0,n.A)(function*(){return yield t.queue((0,n.A)(function*(){return(yield r.isLocationEnabled()).value}))})()}openLocationSettings(){var t=this;return(0,n.A)(function*(){yield t.queue((0,n.A)(function*(){yield r.openLocationSettings()}))})()}openBluetoothSettings(){var t=this;return(0,n.A)(function*(){yield t.queue((0,n.A)(function*(){yield r.openBluetoothSettings()}))})()}openAppSettings(){var t=this;return(0,n.A)(function*(){yield t.queue((0,n.A)(function*(){yield r.openAppSettings()}))})()}setDisplayStrings(t){var e=this;return(0,n.A)(function*(){yield e.queue((0,n.A)(function*(){yield r.setDisplayStrings(t)}))})()}requestDevice(t){var e=this;return(0,n.A)(function*(){return t=t?e.validateRequestBleDeviceOptions(t):void 0,yield e.queue((0,n.A)(function*(){return yield r.requestDevice(t)}))})()}requestLEScan(t,e){var i=this;return(0,n.A)(function*(){t=i.validateRequestBleDeviceOptions(t),yield i.queue((0,n.A)(function*(){var s;yield null===(s=i.scanListener)||void 0===s?void 0:s.remove(),i.scanListener=yield r.addListener("onScanResult",a=>{const h=Object.assign(Object.assign({},a),{manufacturerData:i.convertObject(a.manufacturerData),serviceData:i.convertObject(a.serviceData),rawAdvertisement:a.rawAdvertisement?i.convertValue(a.rawAdvertisement):void 0});e(h)}),yield r.requestLEScan(t)}))})()}stopLEScan(){var t=this;return(0,n.A)(function*(){yield t.queue((0,n.A)(function*(){var e;yield null===(e=t.scanListener)||void 0===e?void 0:e.remove(),t.scanListener=null,yield r.stopLEScan()}))})()}getDevices(t){var e=this;return(0,n.A)(function*(){if(!Array.isArray(t))throw new Error("deviceIds must be an array");return e.queue((0,n.A)(function*(){return(yield r.getDevices({deviceIds:t})).devices}))})()}getConnectedDevices(t){var e=this;return(0,n.A)(function*(){if(!Array.isArray(t))throw new Error("services must be an array");return t=t.map(_),e.queue((0,n.A)(function*(){return(yield r.getConnectedDevices({services:t})).devices}))})()}connect(t,e,i){var s=this;return(0,n.A)(function*(){yield s.queue((0,n.A)(function*(){var a;if(e){const h=`disconnected|${t}`;yield null===(a=s.eventListeners.get(h))||void 0===a?void 0:a.remove();const y=yield r.addListener(h,()=>{e(t)});s.eventListeners.set(h,y)}yield r.connect(Object.assign({deviceId:t},i))}))})()}createBond(t,e){var i=this;return(0,n.A)(function*(){yield i.queue((0,n.A)(function*(){yield r.createBond(Object.assign({deviceId:t},e))}))})()}isBonded(t){var e=this;return(0,n.A)(function*(){return yield e.queue((0,n.A)(function*(){return(yield r.isBonded({deviceId:t})).value}))})()}disconnect(t){var e=this;return(0,n.A)(function*(){yield e.queue((0,n.A)(function*(){yield r.disconnect({deviceId:t})}))})()}getServices(t){var e=this;return(0,n.A)(function*(){return yield e.queue((0,n.A)(function*(){return(yield r.getServices({deviceId:t})).services}))})()}discoverServices(t){var e=this;return(0,n.A)(function*(){yield e.queue((0,n.A)(function*(){yield r.discoverServices({deviceId:t})}))})()}getMtu(t){var e=this;return(0,n.A)(function*(){return yield e.queue((0,n.A)(function*(){return(yield r.getMtu({deviceId:t})).value}))})()}requestConnectionPriority(t,e){var i=this;return(0,n.A)(function*(){yield i.queue((0,n.A)(function*(){yield r.requestConnectionPriority({deviceId:t,connectionPriority:e})}))})()}readRssi(t){var e=this;return(0,n.A)(function*(){return yield e.queue((0,n.A)(function*(){const s=yield r.readRssi({deviceId:t});return parseFloat(s.value)}))})()}read(t,e,i,s){var a=this;return(0,n.A)(function*(){return e=_(e),i=_(i),yield a.queue((0,n.A)(function*(){const y=yield r.read(Object.assign({deviceId:t,service:e,characteristic:i},s));return a.convertValue(y.value)}))})()}write(t,e,i,s,a){var h=this;return(0,n.A)(function*(){return e=_(e),i=_(i),h.queue((0,n.A)(function*(){if(null==s||!s.buffer)throw new Error("Invalid data.");let y=s;"web"!==D.Ii.getPlatform()&&(y=(0,u.pX)(s)),yield r.write(Object.assign({deviceId:t,service:e,characteristic:i,value:y},a))}))})()}writeWithoutResponse(t,e,i,s,a){var h=this;return(0,n.A)(function*(){e=_(e),i=_(i),yield h.queue((0,n.A)(function*(){if(null==s||!s.buffer)throw new Error("Invalid data.");let y=s;"web"!==D.Ii.getPlatform()&&(y=(0,u.pX)(s)),yield r.writeWithoutResponse(Object.assign({deviceId:t,service:e,characteristic:i,value:y},a))}))})()}readDescriptor(t,e,i,s,a){var h=this;return(0,n.A)(function*(){return e=_(e),i=_(i),s=_(s),yield h.queue((0,n.A)(function*(){const I=yield r.readDescriptor(Object.assign({deviceId:t,service:e,characteristic:i,descriptor:s},a));return h.convertValue(I.value)}))})()}writeDescriptor(t,e,i,s,a,h){var y=this;return(0,n.A)(function*(){return e=_(e),i=_(i),s=_(s),y.queue((0,n.A)(function*(){if(null==a||!a.buffer)throw new Error("Invalid data.");let I=a;"web"!==D.Ii.getPlatform()&&(I=(0,u.pX)(a)),yield r.writeDescriptor(Object.assign({deviceId:t,service:e,characteristic:i,descriptor:s,value:I},h))}))})()}startNotifications(t,e,i,s){var a=this;return(0,n.A)(function*(){e=_(e),i=_(i),yield a.queue((0,n.A)(function*(){var h;const y=`notification|${t}|${e}|${i}`;yield null===(h=a.eventListeners.get(y))||void 0===h?void 0:h.remove();const I=yield r.addListener(y,S=>{s(a.convertValue(null==S?void 0:S.value))});a.eventListeners.set(y,I),yield r.startNotifications({deviceId:t,service:e,characteristic:i})}))})()}stopNotifications(t,e,i){var s=this;return(0,n.A)(function*(){e=_(e),i=_(i),yield s.queue((0,n.A)(function*(){var a;const h=`notification|${t}|${e}|${i}`;yield null===(a=s.eventListeners.get(h))||void 0===a?void 0:a.remove(),s.eventListeners.delete(h),yield r.stopNotifications({deviceId:t,service:e,characteristic:i})}))})()}validateRequestBleDeviceOptions(t){return t.services&&(t.services=t.services.map(_)),t.optionalServices&&(t.optionalServices=t.optionalServices.map(_)),t}convertValue(t){return"string"==typeof t?(0,u.BR)(t):void 0===t?new DataView(new ArrayBuffer(0)):t}convertObject(t){if(void 0===t)return;const e={};for(const i of Object.keys(t))e[i]=this.convertValue(t[i]);return e}}},5432:(g,A,c)=>{c.d(A,{T:()=>E});const E={pressureServiceUUID:"0000fe00-cc7a-482a-984a-7f2ed5b3e58f",notifyPressureCharUUID:"0000fe39-cc7a-482a-984a-7f2ed5b3e58f",motorCharUUID:"0000fe40-cc7a-482a-984a-7f2ed5b3e58f",lowThreshCharUUID:"0000fe42-cc7a-482a-984a-7f2ed5b3e58f",highThreshCharUUID:"0000fe41-cc7a-482a-984a-7f2ed5b3e58f",pumpStateCharUUID:"0000fe43-cc7a-482a-984a-7f2ed5b3e58f",deviceServiceUUID:"0000bc00-cc7a-482a-984a-7f2ed5b3e58f",deviceMacCharUUID:"0000bc39-cc7a-482a-984a-7f2ed5b3e58f",snCharUUID:"0000bc40-cc7a-482a-984a-7f2ed5b3e58f",vnCharUUID:"0000bc41-cc7a-482a-984a-7f2ed5b3e58f",motorRuntimeCharUUID:"0000bc42-cc7a-482a-984a-7f2ed5b3e58f",errorStateCharUUID:"0000bc43-cc7a-482a-984a-7f2ed5b3e58f",totalPagesCharUUID:"0000bc44-cc7a-482a-984a-7f2ed5b3e58f",writingDataCharUUID:"0000bc45-cc7a-482a-984a-7f2ed5b3e58f",resetNVSDataCharUUID:"0000bc46-cc7a-482a-984a-7f2ed5b3e58f",batteryServiceUUID:"0000180f-0000-1000-8000-00805f9b34fb",batteryLevelCharUUID:"00002a19-0000-1000-8000-00805f9b34fb",alertServiceUUID:"0000be00-cc7a-482a-984a-7f2ed5b3e58f",alertNotifyCharUUID:"0000be01-cc7a-482a-984a-7f2ed5b3e58f",dataServiceUUID:"0000dc00-cc7a-482a-984a-7f2ed5b3e58f",pageDataCharUUID:"0000dc20-cc7a-482a-984a-7f2ed5b3e58f",pageOffsetWriteCharUUID:"0000dc21-cc7a-482a-984a-7f2ed5b3e58f",currentPageCharUUID:"0000dc22-cc7a-482a-984a-7f2ed5b3e58f",readFullFlashCharUUID:"0000dc23-cc7a-482a-984a-7f2ed5b3e58f",timeServiceUUID:"00001805-0000-1000-8000-00805f9b34fb",currentTimeCharUUID:"00002a2b-0000-1000-8000-00805f9b34fb",dataTransferServiceUUID:"0000181c-0000-1000-8000-00805f9b34fb",dataTransferCharUUID:"00002b3d-0000-1000-8000-00805f9b34fb",maintenanceTimerCharUUID:"0000fe44-cc7a-482a-984a-7f2ed5b3e58f",normalTimerCharUUID:"0000fe45-cc7a-482a-984a-7f2ed5b3e58f"}},9332:(g,A,c)=>{c.d(A,{u:()=>D});var E=c(467),l=c(4438),n=c(4742);let D=(()=>{var u;class r{constructor(v){this.alertController=v,this.isAlertShow=!1,this.didShowError=!1}presentAlert(){var v=this;return(0,E.A)(function*(){if(v.didShowError||v.isAlertShow)return;const _=yield v.alertController.create({header:"Problem with Pump",subHeader:"There is a problem with the pump",message:"There is a problem with the hybrid pump. You can try to restart the pump, if problem continues please contact support.",buttons:["Ok"],backdropDismiss:!0});v.isAlertShow||(v.isAlertShow=!0,v.didShowError=!0,yield _.present()),_.onDidDismiss().then(()=>{v.isAlertShow=!1})})()}}return(u=r).\u0275fac=function(v){return new(v||u)(l.KVO(n.hG))},u.\u0275prov=l.jDH({token:u,factory:u.\u0275fac,providedIn:"root"}),r})()},1727:(g,A,c)=>{c.d(A,{c:()=>f});var E=c(5083),l=c(3643),n=c(1413),D=c(6354),u=c(6648),r=c(8254),d=c(5432),v=c(4438),_=c(2400);let f=(()=>{var b;class o{constructor(e,i){this.ngZone=e,this.bluetoothNotificationService=i,this._device=new n.B,this._connection=new n.B,this._bleEnabled=new n.B,this._deviceId=new n.B,this.lostPressureAlert=!1,this.isReconnecting=!1,this.reconnectCount=0,this.reconnectThreshold=5,this.statusMessage="",this.deviceIDSignal=(0,v.vPA)(""),this.connectionStatus=(0,v.vPA)(!1),this.isConnecting=(0,v.vPA)(!0),"web"!==E.Ii.getPlatform()&&this.initialize()}get bleEnabledObs(){return this._bleEnabled.asObservable()}get connectionData(){return this._connection.asObservable()}get deviceId(){return this._deviceId.asObservable()}get device(){return this._device.asObservable()}initialize(){this.isConnecting.set(!0);try{l.Fk.initialize({androidNeverForLocation:!0}).then(()=>this._bleEnabled.next(!0),()=>this._bleEnabled.next(!1)),this.initializeBluetooth()}catch(e){console.log("BLE INITIALIZE ERROR:",e)}}initializeBluetooth(){l.Fk||this.initialize(),this.checkBluetooth().then(e=>{e||console.log("Bluetooth is not enabled, turn bluetooth on to continue")},e=>{console.log("Bluetooth Error",e)}),this.connectionStatus()||this.autoConnect().pipe((0,D.T)(e=>{e?(this.deviceIDSignal.set(e),this.onConnectDevice(e)):(console.log("no device id, requesting device"),this.requestDevice())})).subscribe(),this.connectionData.subscribe(e=>{this.isConnecting.set(!1),e?this.bluetoothNotificationService.notificationInit(this.deviceIDSignal()):this.onConnectDevice(this.deviceIDSignal())})}stopScan(){try{l.Fk.stopLEScan()}catch(e){console.log("BLE DEINITIALIZE ERROR:",e)}}checkBluetooth(){return l.Fk.isEnabled()}disconnectDevice(e){return l.Fk.disconnect(e)}removeDevice(){r.p.remove({key:"bluetooth_device"})}requestDevice(){return l.Fk.requestDevice({services:[d.T.pressureServiceUUID,d.T.batteryServiceUUID,d.T.deviceServiceUUID,d.T.alertServiceUUID,d.T.dataServiceUUID,d.T.dataTransferServiceUUID],optionalServices:[d.T.timeServiceUUID]}).then(e=>{console.log("DEVICE ID:",e),this.onConnectDevice(e.deviceId)}).catch(e=>{console.log("ERROR requestDevice():",e),this.isConnecting.set(!1)}).catch(e=>{console.log("ERROR requestDevice():",e),this.isConnecting.set(!1)})}autoConnect(){return(0,u.H)(r.p.get({key:"bluetooth_device"})).pipe((0,D.T)(e=>e&&e.value?e.value:null))}listDevices(){this.setStatus("Scanning for bluetooth LE devices"),l.Fk.requestLEScan({},e=>{this.onDeviceDiscovered(e)}),setTimeout(()=>{l.Fk.stopLEScan()},1e4)}onDeviceDiscovered(e){this.ngZone.run(()=>{this._device.next(e)})}onConnectDevice(e){if(r.p.set({key:"bluetooth_device",value:e}),this._deviceId.next(e),this.deviceIDSignal.set(e),"ios"===E.Ii.getPlatform()&&(l.Fk.requestLEScan({},i=>{this.onDeviceDiscovered(i)}),setTimeout(()=>{l.Fk.stopLEScan();try{this.tryConnect(e)}catch(i){console.log("ERROR onConnectDevice():",i)}},3e3)),"android"===E.Ii.getPlatform()||"web"===E.Ii.getPlatform())try{l.Fk.disconnect(e).then(i=>{this.tryConnect(e)},i=>{this._connection.next(!1),this.connectionStatus.set(!1)})}catch(i){console.log("BLE CONNECTING ERROR:",i),this._connection.next(!1),this.connectionStatus.set(!1)}}tryConnect(e){l.Fk.connect(e,i=>{this._connection.next(!1),this.connectionStatus.set(!1),console.log("DEVICE DISCONNECTED:",e,"---",(new Date).toISOString())}).then(i=>{console.log("BLE DEVICE CONNECTED: ",e),this.isReconnecting=!1,this._connection.next(!0),this.connectionStatus.set(!0),this.reconnectCount=0,this.lostPressureAlert=!1},i=>{console.log("DEVICE CONNECTION FAILURE IN SCAN:",i,e,"---",(new Date).toISOString()),this.reconnectCount+=1,this.onConnectDevice(e)})}reconnection(){this.isReconnecting||(this.isReconnecting=!0,this._connection.next(!1),this.connectionStatus.set(!1),this.onConnectDevice(this.deviceIDSignal()))}setStatus(e){this.ngZone.run(()=>{this.statusMessage=e})}}return(b=o).\u0275fac=function(e){return new(e||b)(v.KVO(v.SKi),v.KVO(_.V))},b.\u0275prov=v.jDH({token:b,factory:b.\u0275fac,providedIn:"root"}),o})()},2400:(g,A,c)=>{c.d(A,{V:()=>_});var E=c(467),l=c(4438),n=c(3643),D=c(1413),u=c(5432),r=c(9367),d=c(5816),v=c(9332);let _=(()=>{var f;class b{constructor(t){this.alertService=t,this._notifyData=new D.B,this._recordingState=new D.B,this.batteryLevelSignal=(0,l.vPA)(0),this.pumpStateSignal=(0,l.vPA)(0),this.currentPressureSignal=(0,l.vPA)(0),this.alertTypeSignal=(0,l.vPA)(0),this.errorStateSignal=(0,l.vPA)(0),this.currentTimeSignal=(0,l.vPA)(0),this.totalPagesSignal=(0,l.vPA)(0),this.motorRunTimeLimitSignal=(0,l.vPA)(0),this.lowThresholdSignal=(0,l.vPA)(0),this.highThresholdSignal=(0,l.vPA)(0),this.progress=(0,l.vPA)(0),this.fullFlashData=[],this.fullFlashPages=0}get notifyData(){return this._notifyData.asObservable()}get recordingState(){return this._recordingState.asObservable()}notificationInit(t){this.onNotifyData(t),this.onNotifyBatteryData(t),this.onAlertData(t)}onNotifyData(t){var e=this;return(0,E.A)(function*(){const i=u.T.pressureServiceUUID,s=u.T.notifyPressureCharUUID;let a;yield n.Fk.startNotifications(t,i,s,h=>{a=+d.N.parseInt16DataReading(h).toString();let y=r.n.millivoltsToInches(a);e.currentPressureSignal.set(y),e._notifyData.next(y)})})()}onAlertData(t){var e=this;return(0,E.A)(function*(){const i=u.T.alertServiceUUID,s=u.T.alertNotifyCharUUID;let a;yield n.Fk.startNotifications(t,i,s,h=>{a=+d.N.parseInt8DataReading(h).toString(),e.alertTypeSignal.set(a),e.alertService.presentAlert()})})()}onNotifyBatteryData(t){var e=this;return(0,E.A)(function*(){const i=u.T.batteryServiceUUID,s=u.T.batteryLevelCharUUID;let a;yield n.Fk.startNotifications(t,i,s,h=>{a=d.N.parseBatteryReading(h),e.batteryLevelSignal.set(a)})})()}}return(f=b).\u0275fac=function(t){return new(t||f)(l.KVO(v.u))},f.\u0275prov=l.jDH({token:f,factory:f.\u0275fac,providedIn:"root"}),b})()},9367:(g,A,c)=>{c.d(A,{n:()=>l});var E=c(4438);let l=(()=>{var n;class D{static inchesToMillivolts(r){return-50*r+1750}static millivoltsToInches(r){return(r-1750)/-50}constructor(){}}return(n=D).\u0275fac=function(r){return new(r||n)},n.\u0275prov=E.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),D})()},5816:(g,A,c)=>{c.d(A,{N:()=>E});class E{static setUint32DataView(n){const D=new ArrayBuffer(4),u=new DataView(D);return u.setUint32(0,n,!0),u}static setPumpStateDataView(n){const D=new ArrayBuffer(1),u=new DataView(D);return u.setUint8(0,n),u}static parseInt16DataReading(n){const u=new Int16Array(n.byteLength/Int16Array.BYTES_PER_ELEMENT);for(let d=0;d<u.length;d++)u[d]=n.getInt16(d*Int32Array.BYTES_PER_ELEMENT,!0);return u}static parseInt32DataReading(n){const u=new Int32Array(n.byteLength/Int32Array.BYTES_PER_ELEMENT);for(let d=0;d<u.length;d++)u[d]=n.getInt32(d*Int32Array.BYTES_PER_ELEMENT,!0);return u[0]}static parseInt8DataReading(n){return n.getInt8(0)}static parseBatteryReading(n){return n.getInt32(0,!0)}}}}]);